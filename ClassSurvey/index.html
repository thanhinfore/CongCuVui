<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <meta name="description" content="ClassSurvey - Ph√¢n t√≠ch v√† bi·ªÉu di·ªÖn k·∫øt qu·∫£ kh·∫£o s√°t l·ªõp h·ªçc t·ª´ Google Sheets">
    <meta name="theme-color" content="#6366f1">

    <title>üìä ClassSurvey - Ph√¢n t√≠ch kh·∫£o s√°t l·ªõp h·ªçc</title>

    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Styles -->
    <link rel="stylesheet" href="css/main.css">

    <!-- Chart.js for visualization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js" defer></script>

    <!-- PapaParse for CSV parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js" defer></script>
</head>
<body>
    <div class="container">
        <!-- ================================================================
             SETUP SCREEN - M√†n h√¨nh thi·∫øt l·∫≠p ban ƒë·∫ßu
             ================================================================ -->
        <div class="setup-screen active" id="setupScreen">
            <div class="setup-card">
                <div class="setup-header">
                    <div class="setup-logo" role="img" aria-label="Survey icon">üìä</div>
                    <h1>ClassSurvey</h1>
                    <p>Ph√¢n t√≠ch k·∫øt qu·∫£ kh·∫£o s√°t l·ªõp h·ªçc t·ª´ Google Sheets</p>
                </div>

                <form class="setup-form" id="setupForm" novalidate>
                    <div class="form-group">
                        <label for="csvUrl">
                            <span class="label-icon" aria-hidden="true">üìä</span>
                            <span>Google Sheets CSV URL</span>
                            <span class="label-hint">(Link d·ªØ li·ªáu kh·∫£o s√°t)</span>
                        </label>
                        <input type="url"
                               id="csvUrl"
                               name="csvUrl"
                               placeholder="https://docs.google.com/spreadsheets/d/e/..."
                               autocomplete="url"
                               spellcheck="false"
                               required
                               aria-describedby="csvUrlHint csvUrlValidation">
                        <div class="input-hint" id="csvUrlHint">
                            <strong>C√°ch l·∫•y link:</strong><br>
                            1. M·ªü Google Form responses ‚Üí Click "View in Sheets"<br>
                            2. Trong Sheets: <strong>File</strong> ‚Üí <strong>Share</strong> ‚Üí <strong>Publish to web</strong><br>
                            3. Ch·ªçn ƒë·ªãnh d·∫°ng <strong>CSV</strong> ‚Üí Click <strong>Publish</strong><br>
                            4. Copy link CSV ƒë∆∞·ª£c t·∫°o v√† d√°n v√†o ƒë√¢y
                        </div>
                        <div class="validation-msg" id="csvUrlValidation" role="alert"></div>
                    </div>

                    <div class="form-group">
                        <label for="surveyTitle">
                            <span class="label-icon" aria-hidden="true">‚úèÔ∏è</span>
                            <span>T√™n kh·∫£o s√°t</span>
                            <span class="label-hint">(T√πy ch·ªçn)</span>
                        </label>
                        <input type="text"
                               id="surveyTitle"
                               name="surveyTitle"
                               placeholder="VD: Kh·∫£o s√°t √Ω ki·∫øn l·ªõp h·ªçc K67"
                               autocomplete="off">
                    </div>

                    <button type="button" class="test-btn" id="testConnection" aria-label="Ki·ªÉm tra k·∫øt n·ªëi ƒë·∫øn Google Sheets">
                        üîç Ki·ªÉm tra k·∫øt n·ªëi
                    </button>

                    <button type="submit" class="submit-btn" id="submitBtn">
                        üöÄ B·∫Øt ƒë·∫ßu ph√¢n t√≠ch
                    </button>
                </form>

                <!-- Recent Sessions -->
                <div class="recent-sessions" id="recentSessions">
                    <div class="sessions-header">
                        <h3>üìö Kh·∫£o s√°t g·∫ßn ƒë√¢y</h3>
                        <button class="clear-history-btn"
                                id="clearHistory"
                                aria-label="X√≥a l·ªãch s·ª≠">
                            üóëÔ∏è X√≥a
                        </button>
                    </div>
                    <div class="sessions-list" id="sessionsList" role="list"></div>
                </div>

                <!-- Quick Guide -->
                <div class="quick-guide">
                    <button class="guide-toggle"
                            id="guideToggle"
                            aria-expanded="false"
                            aria-controls="guideContent">
                        ‚ùì H∆∞·ªõng d·∫´n chi ti·∫øt
                    </button>
                    <div class="guide-content" id="guideContent" aria-hidden="true">
                        <h4>ƒê·ªãnh d·∫°ng d·ªØ li·ªáu Google Sheets</h4>
                        <p>ClassSurvey h·ªó tr·ª£ d·ªØ li·ªáu t·ª´ Google Forms v·ªõi c·∫•u tr√∫c:</p>
                        <ul>
                            <li><strong>C·ªôt 1:</strong> Timestamp (th·ªùi gian submit)</li>
                            <li><strong>C·ªôt 2+:</strong> C√¢u h·ªèi v√† c√¢u tr·∫£ l·ªùi</li>
                        </ul>

                        <h4>C√°c lo·∫°i c√¢u h·ªèi ƒë∆∞·ª£c h·ªó tr·ª£</h4>
                        <ul>
                            <li>‚úÖ Multiple choice (m·ªôt l·ª±a ch·ªçn)</li>
                            <li>‚úÖ Checkboxes (nhi·ªÅu l·ª±a ch·ªçn)</li>
                            <li>‚úÖ Short answer (vƒÉn b·∫£n ng·∫Øn)</li>
                            <li>‚úÖ Linear scale (thang ƒëi·ªÉm)</li>
                            <li>‚úÖ Dropdown (danh s√°ch)</li>
                        </ul>

                        <h4>T√≠nh nƒÉng ph√¢n t√≠ch</h4>
                        <ul>
                            <li>üìä Bi·ªÉu ƒë·ªì c·ªôt (Bar Chart)</li>
                            <li>ü•ß Bi·ªÉu ƒë·ªì tr√≤n (Pie Chart)</li>
                            <li>üìà Bi·ªÉu ƒë·ªì ƒë∆∞·ªùng (Line Chart)</li>
                            <li>üìâ Bi·ªÉu ƒë·ªì ngang (Horizontal Bar)</li>
                            <li>üî¢ Th·ªëng k√™ s·ªë li·ªáu chi ti·∫øt</li>
                            <li>üíæ Export k·∫øt qu·∫£ (JSON/CSV)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- ================================================================
             MAIN APP - M√†n h√¨nh ph√¢n t√≠ch ch√≠nh
             ================================================================ -->
        <div class="main-app" id="mainApp">
            <!-- Header -->
            <header class="header" role="banner">
                <div class="logo">üìä ClassSurvey</div>
                <div class="survey-info" id="surveyInfo">
                    <span class="survey-title" id="displaySurveyTitle">Kh·∫£o s√°t</span>
                </div>
                <div class="header-controls">
                    <div class="stat-badge" aria-label="T·ªïng s·ªë c√¢u h·ªèi">
                        <span aria-hidden="true">üìã</span>
                        <span class="stat-value" id="totalQuestions">0</span>
                        <span>c√¢u</span>
                    </div>
                    <div class="stat-badge" aria-label="T·ªïng s·ªë ph·∫£n h·ªìi">
                        <span aria-hidden="true">üë•</span>
                        <span class="stat-value" id="totalResponses">0</span>
                        <span>ph·∫£n h·ªìi</span>
                    </div>
                    <button class="refresh-btn"
                            id="refreshBtn"
                            aria-label="L√†m m·ªõi d·ªØ li·ªáu">
                        <span class="refresh-icon" aria-hidden="true">üîÑ</span>
                        Refresh
                    </button>
                    <button class="menu-btn"
                            id="menuBtn"
                            aria-label="M·ªü menu"
                            aria-expanded="false"
                            aria-controls="dropdownMenu">
                        ‚öôÔ∏è
                    </button>
                </div>
            </header>

            <!-- Dropdown Menu -->
            <nav class="dropdown-menu" id="dropdownMenu" aria-label="Menu ch√≠nh">
                <button class="menu-item" id="exportJSON">üíæ Export JSON</button>
                <button class="menu-item" id="exportCSV">üìÑ Export CSV</button>
                <button class="menu-item" id="printResults">üñ®Ô∏è In k·∫øt qu·∫£</button>
                <button class="menu-item" id="newSession">‚ûï Kh·∫£o s√°t m·ªõi</button>
            </nav>

            <!-- Main Content -->
            <main class="main-layout" role="main">
                <!-- Questions Navigation -->
                <aside class="questions-nav" id="questionsNav">
                    <div class="nav-header">
                        <h3>Danh s√°ch c√¢u h·ªèi</h3>
                    </div>
                    <div class="nav-list" id="navList" role="list">
                        <div class="empty-state">
                            <div class="empty-icon">üì•</div>
                            <div>ƒêang t·∫£i...</div>
                        </div>
                    </div>
                </aside>

                <!-- Content Area -->
                <div class="content-area">
                    <!-- Chart Controls -->
                    <div class="chart-controls">
                        <div class="control-group">
                            <label for="chartType">
                                <span class="label-icon">üìä</span>
                                Lo·∫°i bi·ªÉu ƒë·ªì
                            </label>
                            <select id="chartType" class="chart-select">
                                <option value="bar">C·ªôt d·ªçc (Bar)</option>
                                <option value="horizontalBar">C·ªôt ngang (Horizontal)</option>
                                <option value="pie">Tr√≤n (Pie)</option>
                                <option value="doughnut">Donut (Doughnut)</option>
                                <option value="line">ƒê∆∞·ªùng (Line)</option>
                                <option value="radar">Radar</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label for="colorScheme">
                                <span class="label-icon">üé®</span>
                                B·∫£ng m√†u
                            </label>
                            <select id="colorScheme" class="chart-select">
                                <option value="vibrant">Vibrant</option>
                                <option value="pastel">Pastel</option>
                                <option value="professional">Professional</option>
                                <option value="ocean">Ocean</option>
                                <option value="sunset">Sunset</option>
                                <option value="neon">Neon</option>
                            </select>
                        </div>
                    </div>

                    <!-- Question Display -->
                    <div class="question-display" id="questionDisplay">
                        <div class="question-header">
                            <div class="question-number" id="questionNumber">C√¢u 1</div>
                            <div class="question-text" id="questionText">ƒêang t·∫£i c√¢u h·ªèi...</div>
                        </div>

                        <!-- Statistics Summary -->
                        <div class="stats-summary" id="statsSummary">
                            <div class="stat-item">
                                <div class="stat-label">T·ªïng ph·∫£n h·ªìi</div>
                                <div class="stat-value" id="questionResponses">0</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">S·ªë l·ª±a ch·ªçn</div>
                                <div class="stat-value" id="questionOptions">0</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-label">Ph·ªï bi·∫øn nh·∫•t</div>
                                <div class="stat-value" id="questionMostPopular">-</div>
                            </div>
                        </div>

                        <!-- Chart Container -->
                        <div class="chart-container">
                            <canvas id="surveyChart" role="img" aria-label="Bi·ªÉu ƒë·ªì k·∫øt qu·∫£ kh·∫£o s√°t"></canvas>
                        </div>

                        <!-- Data Table -->
                        <div class="data-table-container">
                            <table class="data-table" id="dataTable">
                                <thead>
                                    <tr>
                                        <th>L·ª±a ch·ªçn</th>
                                        <th>S·ªë l∆∞·ª£ng</th>
                                        <th>T·ª∑ l·ªá %</th>
                                    </tr>
                                </thead>
                                <tbody id="dataTableBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- ================================================================
             LOADING OVERLAY
             ================================================================ -->
        <div class="loading-overlay" id="loadingOverlay" aria-live="polite" aria-busy="true">
            <div class="loading-spinner" role="status" aria-label="ƒêang t·∫£i"></div>
            <div class="loading-text" id="loadingText">ƒêang ki·ªÉm tra k·∫øt n·ªëi...</div>
        </div>

        <!-- ================================================================
             TOAST NOTIFICATIONS
             ================================================================ -->
        <div class="toast-container" id="toastContainer" role="region" aria-live="polite" aria-atomic="true"></div>

        <!-- ================================================================
             ERROR BOX
             ================================================================ -->
        <div class="error-box" id="errorBox" role="alert" aria-live="assertive">
            <div class="error-title">‚ö†Ô∏è L·ªói</div>
            <div id="errorMessage"></div>
            <button class="error-action-btn" id="closeError">
                ‚úï ƒê√≥ng
            </button>
        </div>
    </div>

    <!-- Application Scripts -->
    <script src="js/googleSheetsHandler.js"></script>
    <script src="js/surveyManager.js"></script>
    <script src="js/chartRenderer.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
